<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Animate &#8212; Gaussian-2-Blender 2025.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <script src="../_static/documentation_options.js?v=9da58f5d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for Animate</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mathutils</span>

<span class="nb">dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
    
<div class="viewcode-block" id="clear_all_animations">
<a class="viewcode-back" href="../api.html#Animate.clear_all_animations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_all_animations</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes all keyframes for all objects in the scene</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
    <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
        <span class="n">ob</span><span class="o">.</span><span class="n">animation_data_clear</span><span class="p">()</span>
    <span class="n">all_actions</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actions</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">all_actions</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">action</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="calculate_number_of_frames">
<a class="viewcode-back" href="../api.html#Animate.calculate_number_of_frames">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_number_of_frames</span><span class="p">(</span><span class="n">anim_frames_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the number of animation frames based on an input file.</span>
<span class="sd">    </span>
<span class="sd">    :param anim_frames_path: Path to the animation frames data file.</span>
<span class="sd">    :type anim_frames_path: str</span>
<span class="sd">    :return: Number of frames in the animation.</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">anim_frames_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Read the first line</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">first_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="c1"># Split the line into parts</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># Remove the element identifier</span>
        <span class="c1"># The number of frames is the total number of coordinates divided by 3 (since each frame has 3 coordinates per element)</span>
        <span class="n">num_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>        
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_frames</span><span class="p">)</span></div>


<div class="viewcode-block" id="separate_elements_from_bonds">
<a class="viewcode-back" href="../api.html#Animate.separate_elements_from_bonds">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">separate_elements_from_bonds</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Categorizes scene objects as elements or bonds based on naming conventions.</span>
<span class="sd">    </span>
<span class="sd">    :return: A tuple containing lists of elements and bonds.</span>
<span class="sd">    :rtype: tuple[list, list]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bonds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;highlight&quot;</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># Skip objects that are highlights</span>
        <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;%&#39;</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">bonds</span><span class="p">)</span></div>


<div class="viewcode-block" id="filter_bond_list_by_type">
<a class="viewcode-back" href="../api.html#Animate.filter_bond_list_by_type">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_bond_list_by_type</span><span class="p">(</span><span class="n">bond_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Categorizes bonds into different types based on naming conventions.</span>
<span class="sd">    </span>
<span class="sd">    :param bond_list: List of bond objects.</span>
<span class="sd">    :type bond_list: list</span>
<span class="sd">    :return: Tuple of categorized bond lists (dashed, single, aromatic, double, triple bonds).</span>
<span class="sd">    :rtype: tuple[list, list, list, list, list]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dashed_bonds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">single_bonds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arom_bonds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">double_bonds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">triple_bonds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">dashed_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">single_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;%&#39;</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">arom_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">double_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">triple_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: filtering bonds has a non-resolved case&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dashed_bonds</span><span class="p">,</span> <span class="n">single_bonds</span><span class="p">,</span> <span class="n">arom_bonds</span><span class="p">,</span> <span class="n">double_bonds</span><span class="p">,</span> <span class="n">triple_bonds</span></div>


<div class="viewcode-block" id="insert_keyframes_to_all">
<a class="viewcode-back" href="../api.html#Animate.insert_keyframes_to_all">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">insert_keyframes_to_all</span><span class="p">(</span><span class="n">number_of_frames</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inserts location keyframes for all objects in the scene at specified frame intervals.</span>
<span class="sd">    </span>
<span class="sd">    :param number_of_frames: Total number of frames.</span>
<span class="sd">    :type number_of_frames: int</span>
<span class="sd">    :param step_size: Frame interval for keyframe insertion.</span>
<span class="sd">    :type step_size: int, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">number_of_frames</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span> <span class="c1">#looping through all objects in the scene</span>
            <span class="n">ob</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="n">step_size</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="update_keyframe_locations">
<a class="viewcode-back" href="../api.html#Animate.update_keyframe_locations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_keyframe_locations</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates and inserts keyframe locations for a target object.</span>
<span class="sd">    </span>
<span class="sd">    :param target: Object to update.</span>
<span class="sd">    :type target: bpy.types.Object</span>
<span class="sd">    :param step_size: Interval between frames.</span>
<span class="sd">    :type step_size: int</span>
<span class="sd">    :param locations: List of location vectors for keyframes.</span>
<span class="sd">    :type locations: list[mathutils.Vector]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#first keyframe is the first location</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)):</span>  <span class="c1"># start from 1 since the 0th frame is already inserted</span>
            <span class="n">target</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># Set the location to the ith vector</span>
            <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_size</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="update_keyframe_rotations_quaternion">
<a class="viewcode-back" href="../api.html#Animate.update_keyframe_rotations_quaternion">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_keyframe_rotations_quaternion</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates keyframe rotations for a target object using quaternion rotations based on normal vectors.</span>

<span class="sd">    :param target: Object to update.</span>
<span class="sd">    :type target: bpy.types.Object</span>
<span class="sd">    :param step_size: Interval between frames.</span>
<span class="sd">    :type step_size: int</span>
<span class="sd">    :param normals: List of normal vectors for each frame.</span>
<span class="sd">    :type normals: list[mathutils.Vector]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target</span><span class="o">.</span><span class="n">rotation_mode</span> <span class="o">=</span> <span class="s1">&#39;QUATERNION&#39;</span>
    <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;rotation_quaternion&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">z_axis</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Default orientation</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">normal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">normals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">normal</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># Skip zero-length vectors to avoid errors</span>
        <span class="n">rotation_quat</span> <span class="o">=</span> <span class="n">z_axis</span><span class="o">.</span><span class="n">rotation_difference</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">rotation_quaternion</span> <span class="o">=</span> <span class="n">rotation_quat</span>
        <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;rotation_quaternion&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="n">step_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_keyframe_rotations">
<a class="viewcode-back" href="../api.html#Animate.update_keyframe_rotations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_keyframe_rotations</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates keyframe rotations for a target object based on normals.</span>

<span class="sd">    :param target: Object to update.</span>
<span class="sd">    :type target: bpy.types.Object</span>
<span class="sd">    :param step_size: Interval between frames.</span>
<span class="sd">    :type step_size: int</span>
<span class="sd">    :param normals: List of normal vectors for each frame</span>
<span class="sd">    :type normals: list[mathutils.Vector]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># function not used in version 2025.7 I&#39;m replacing it with the update_keyframe_rotations_quaternion version.</span>
    <span class="c1"># the quaternions function was written by a LLM, I don&#39;t understand it. I&#39;m leaving the update_keyframe_rotations </span>
    <span class="c1"># here to fall back in case things fall apart because I&#39;m not using a function I 100% understand what is doing.</span>
    <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;rotation_euler&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">normal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">normals</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">normal</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">normal</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">normal</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">normal</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">target</span><span class="o">.</span><span class="n">rotation_euler</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">target</span><span class="o">.</span><span class="n">rotation_euler</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span>
        <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;rotation_euler&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="n">step_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_keyframe_scale">
<a class="viewcode-back" href="../api.html#Animate.update_keyframe_scale">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_keyframe_scale</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">bond_name</span><span class="p">,</span> <span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">,</span> <span class="n">step_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates keyframe scales for a target object based on the distance between two atoms.</span>

<span class="sd">    :param target: Object to update.</span>
<span class="sd">    :type target: bpy.types.Object</span>
<span class="sd">    :param bond_name: Name of the bond</span>
<span class="sd">    :type bond_name: str</span>
<span class="sd">    :param anim_data: Animation data containing atom positions.</span>
<span class="sd">    :type anim_data: List[List[mathutils.Vector]]</span>
<span class="sd">    :param bond_type: Character separating the two atoms in the bond name.</span>
<span class="sd">    :type bond_type: str</span>
<span class="sd">    :param step_size: Interval between frames.</span>
<span class="sd">    :type step_size: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">bond_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bond_type</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">anim_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="k">elif</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bond components not found in the animation data.&quot;</span><span class="p">)</span>

    <span class="n">initial_distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">length</span>
    <span class="k">if</span> <span class="n">initial_distance</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Initial distance between atoms is zero.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="p">)):</span>
        <span class="n">current_distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">length</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">current_distance</span> <span class="o">/</span> <span class="n">initial_distance</span>
        <span class="n">target</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">scale_factor</span>
        <span class="n">target</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="n">step_size</span><span class="p">)</span></div>


        
<div class="viewcode-block" id="ExtractDataFromFile">
<a class="viewcode-back" href="../api.html#Animate.ExtractDataFromFile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ExtractDataFromFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts data from a path and stores it as a list</span>

<span class="sd">    :param path: &lt;string&gt; path to read the file</span>
<span class="sd">    :returns: List[str] of data. Each entry corresponds to a line in the file to read</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="c1"># store the line as list in file_data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;8.1: The data in animation_frames.txt was properly read&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span></div>


<div class="viewcode-block" id="refine_anim_data">
<a class="viewcode-back" href="../api.html#Animate.refine_anim_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">refine_anim_data</span><span class="p">(</span><span class="n">raw_anim_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts raw animation data into numerical vectors.</span>
<span class="sd">    </span>
<span class="sd">    :param raw_anim_data: Raw animation data.</span>
<span class="sd">    :type raw_anim_data: list[list[str]]</span>
<span class="sd">    :return: Refined animation data with numerical vectors.</span>
<span class="sd">    :rtype: list[list]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">refined_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">raw_anim_data</span><span class="p">:</span>
        <span class="n">element_identifier</span> <span class="o">=</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Loop through the coordinate sets</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_point</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_point</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_point</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_point</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="n">mathutils</span><span class="o">.</span><span class="n">Vector</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
            <span class="n">vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="n">refined_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">element_identifier</span><span class="p">]</span> <span class="o">+</span> <span class="n">vectors</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;8.2: The animation data was refined into numerical vectors&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">refined_data</span></div>


<div class="viewcode-block" id="get_bond_locations">
<a class="viewcode-back" href="../api.html#Animate.get_bond_locations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_bond_locations</span><span class="p">(</span><span class="n">bond_name</span><span class="p">,</span> <span class="n">anim_data</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the center of mass for each bond location.</span>

<span class="sd">    :param bond_name: The name of the bond.</span>
<span class="sd">    :type bond_name: str</span>
<span class="sd">    :param anim_data: The animation data.</span>
<span class="sd">    :type anim_data: List[str]</span>
<span class="sd">    :param type: The bond type.</span>
<span class="sd">    :type type: char</span>
<span class="sd">    :return: The list of center locations for each bond.</span>
<span class="sd">    :rtype: List[mathutils.Vector]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Get bond locations is being called&quot;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to store center locations</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">bond_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>  <span class="c1"># Splitting bond_name to get the two atoms involved</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Loop through anim_data to find vectors for the two components</span>
    <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">anim_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>  <span class="c1"># Extract all vectors for the first component</span>
        <span class="k">elif</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>  <span class="c1"># Extract all vectors for the second component</span>

        <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>  <span class="c1"># Stop the loop when both r1 and r2 are found</span>
    <span class="c1"># Ensure both r1 and r2 are populated</span>
    <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bond components not found in the animation data.&quot;</span><span class="p">)</span>
    <span class="c1"># Calculate the center of mass for each corresponding pair of vectors in r1 and r2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="p">)):</span>  <span class="c1"># Assuming r1 and r2 have the same number of vectors</span>
        <span class="n">v_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">r2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># Calculate the center of mass</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_i</span><span class="p">)</span>  <span class="c1"># Append the center of mass to the list</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bond locations are:&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span></div>


<div class="viewcode-block" id="get_bond_normals">
<a class="viewcode-back" href="../api.html#Animate.get_bond_normals">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_bond_normals</span><span class="p">(</span><span class="n">bond_name</span><span class="p">,</span> <span class="n">anim_data</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the normal vector for each bond location.</span>

<span class="sd">    :param bond_name: (str) The name of the bond.</span>
<span class="sd">    :param anim_data: (List[str]) The animation data.</span>
<span class="sd">    :param type: (str) The bond type.</span>
<span class="sd">    :return: The list of normal vectors for the bond.</span>
<span class="sd">    :rtype: List[Mathutils.Vector]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;get bond normals is being called&quot;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">bond_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="c1">#getting the elements involved in the bond</span>
    <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">anim_data</span><span class="p">:</span>
        <span class="c1">#comparing the elements in the bond with the keyframe locations</span>
        <span class="k">if</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>  <span class="c1"># Extract all vectors for the first component</span>
        <span class="k">elif</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>  <span class="c1"># Extract all vectors for the second component</span>
        <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>  <span class="c1"># Stop the loop when both r1 and r2 are found</span>
    <span class="k">if</span> <span class="n">r1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">r2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bond components not found in the animation data.&quot;</span><span class="p">)</span>
    <span class="c1">#finding normal vector for each bond</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="p">)):</span>  <span class="c1"># Assuming r1 and r2 have the same number of vectors</span>
        <span class="n">n_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>  <span class="c1"># Calculate the normal vector</span>
        <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_i</span><span class="p">)</span>  <span class="c1"># Append the normal vector to the list</span>
    <span class="k">return</span> <span class="n">n</span></div>

            
<div class="viewcode-block" id="animate_elements_from_anim_data">
<a class="viewcode-back" href="../api.html#Animate.animate_elements_from_anim_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">animate_elements_from_anim_data</span><span class="p">(</span><span class="n">anim_data</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Animates elements based on provided animation data.</span>
<span class="sd">    </span>
<span class="sd">    :param anim_data: (List[str]) The animation data.</span>
<span class="sd">    :param step_size: (int) The interval between frames.</span>
<span class="sd">    :param extra_frames: (int) The number of additional frames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;11: elements are being animated&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">anim_data</span><span class="p">:</span>
        <span class="n">current_obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">data_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Getting the current element in animation data</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_point</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>  <span class="c1"># Extract the vector list from the data_point</span>
        <span class="n">update_keyframe_locations</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">current_obj</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">locations</span><span class="p">)</span></div>


<div class="viewcode-block" id="animate_bonds_by_type_list">
<a class="viewcode-back" href="../api.html#Animate.animate_bonds_by_type_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">animate_bonds_by_type_list</span><span class="p">(</span><span class="n">bond_type_list</span><span class="p">,</span> <span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Animates bonds based on their type and provided animation data.</span>
<span class="sd">    </span>
<span class="sd">    :param bond_type_list: (List[char]) The list of bonds to animate.</span>
<span class="sd">    :param anim_data: (List[str]) The animation data.</span>
<span class="sd">    :param bond_type: (char) The bond type.</span>
<span class="sd">    :param step_size: (int) The interval between frames.</span>
<span class="sd">    :param extra_frames: (int) The number of additional frames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;11: bonds are being animated&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bond_type_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bond_type_list</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;animate_bonds_by_type: currently in bond: &quot;</span><span class="p">,</span> <span class="n">bond</span><span class="p">)</span>
            <span class="n">bond_locations</span> <span class="o">=</span> <span class="n">get_bond_locations</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">)</span>
            <span class="n">bond_normals</span> <span class="o">=</span> <span class="n">get_bond_normals</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">)</span>
            <span class="n">update_keyframe_locations</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="n">bond_locations</span><span class="p">)</span>
            <span class="n">update_keyframe_rotations_quaternion</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="n">bond_normals</span><span class="p">)</span>
            <span class="n">update_keyframe_scale</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span> <span class="n">bond_name</span><span class="o">=</span><span class="n">bond</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">anim_data</span><span class="o">=</span><span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_type</span><span class="o">=</span><span class="n">bond_type</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;there are no bonds of type&quot;</span><span class="p">,</span> <span class="n">bond_type</span><span class="p">)</span>    
        <span class="k">return</span></div>

    
<div class="viewcode-block" id="detect_bond_types">
<a class="viewcode-back" href="../api.html#Animate.detect_bond_types">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detect_bond_types</span><span class="p">(</span><span class="n">bond_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the unique bond types from the bond list.</span>

<span class="sd">    :param bond_list: (List[bpy.data.object]) objects corresponding to the bonds in the molecule</span>
<span class="sd">    :return: a set of unique bonds in bond_list </span>
<span class="sd">    :rtype: List[char]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spacer_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
    <span class="n">detected_spacers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">:</span>
        <span class="n">bond_name</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">spacer</span> <span class="ow">in</span> <span class="n">spacer_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">spacer</span> <span class="ow">in</span> <span class="n">bond_name</span><span class="p">:</span>
                <span class="n">detected_spacers</span><span class="p">[</span><span class="n">spacer</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacer_mapping</span><span class="p">[</span><span class="n">spacer</span><span class="p">]</span>
                <span class="k">break</span>  <span class="c1"># Found the spacer, move to the next bond    </span>
    <span class="k">return</span> <span class="n">detected_spacers</span></div>


<div class="viewcode-block" id="build_animations">
<a class="viewcode-back" href="../api.html#Animate.build_animations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">build_animations</span><span class="p">(</span><span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">bond_types</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">extra_frames</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs animations for elements and bonds in the scene.</span>
<span class="sd">    </span>
<span class="sd">    :param anim_data: Processed animation data.</span>
<span class="sd">    :type anim_data: list[list]</span>
<span class="sd">    :param bond_list: List of bond objects.</span>
<span class="sd">    :type bond_list: list</span>
<span class="sd">    :param bond_types: Dictionary mapping bond symbols to indices.</span>
<span class="sd">    :type bond_types: dict</span>
<span class="sd">    :param step_size: Frame interval between keyframes.</span>
<span class="sd">    :type step_size: int</span>
<span class="sd">    :param end_frame: Last frame in the animation.</span>
<span class="sd">    :type end_frame: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;10: Animations are being built&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;10: build_animation() frame end should be:&quot;</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">)</span>
    <span class="c1">#specifying end frame</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_end</span> <span class="o">=</span> <span class="n">end_frame</span>
    <span class="c1">#animating elements</span>
    <span class="n">animate_elements_from_anim_data</span><span class="p">(</span><span class="n">anim_data</span><span class="o">=</span><span class="n">anim_data</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span> 
    <span class="c1">#animating bonds</span>
    <span class="k">for</span> <span class="nb">type</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">bond_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1">#iterating through the dictionary of bonds present in the molecule</span>
        <span class="n">bond_type_list</span> <span class="o">=</span> <span class="n">filter_bond_list_by_type</span><span class="p">(</span><span class="n">bond_list</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="c1">#filtering bond types from bond list</span>
        <span class="n">animate_bonds_by_type_list</span><span class="p">(</span><span class="n">bond_type_list</span><span class="o">=</span><span class="n">bond_type_list</span><span class="p">,</span>
                                   <span class="n">anim_data</span><span class="o">=</span><span class="n">anim_data</span><span class="p">,</span>
                                   <span class="n">bond_type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
                                   <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="bake_for_fbx">
<a class="viewcode-back" href="../api.html#Animate.bake_for_fbx">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bake_for_fbx</span><span class="p">(</span><span class="n">element_list</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;12: Starting baking fbx animations...&quot;</span><span class="p">)</span>
    <span class="n">total_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">element_list</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">bond_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;12.1: Total objects to bake: </span><span class="si">{</span><span class="n">total_objects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">element_list</span> <span class="o">+</span> <span class="n">bond_list</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;12.2: Baking animation for object: </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">nla</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span>
            <span class="n">frame_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_end</span><span class="o">=</span><span class="n">end_frame</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">only_selected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visual_keying</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">clear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">bake_types</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;12.3: Baking complete!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="force_nla_tracks_for_glb">
<a class="viewcode-back" href="../api.html#Animate.force_nla_tracks_for_glb">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">force_nla_tracks_for_glb</span><span class="p">(</span><span class="n">objects</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures that each object has its baked action pushed to an NLA track,</span>
<span class="sd">    which is required for GLB export to include animations.</span>
<span class="sd">    </span>
<span class="sd">    :param objects: List of objects to process</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">animation_data</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">animation_data_create</span><span class="p">()</span>
        
        <span class="n">action</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">animation_data</span><span class="o">.</span><span class="n">action</span>
        <span class="k">if</span> <span class="n">action</span><span class="p">:</span>
            <span class="c1"># Create a new NLA track and push the action into it</span>
            <span class="n">track</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">animation_data</span><span class="o">.</span><span class="n">nla_tracks</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
            <span class="n">track</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_NLA&quot;</span>
            <span class="c1">#strip = track.strips.new(action.name, action.frame_range[0], action)</span>
            <span class="n">track</span><span class="o">.</span><span class="n">strips</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">frame_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">action</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pushed action &#39;</span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; to NLA track for object &#39;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No action found for object &#39;</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="bake_for_glb">
<a class="viewcode-back" href="../api.html#Animate.bake_for_glb">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bake_for_glb</span><span class="p">(</span><span class="n">element_list</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;12: Starting baking glb animations...&quot;</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;DESELECT&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">element_list</span> <span class="o">+</span> <span class="n">bond_list</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">element_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">element_list</span> <span class="k">else</span> <span class="n">bond_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">nla</span><span class="o">.</span><span class="n">bake</span><span class="p">(</span>
        <span class="n">frame_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_end</span><span class="o">=</span><span class="n">end_frame</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">only_selected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visual_keying</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">clear_constraints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">bake_types</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;12.1: Baking complete!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="bake_all_animations">
<a class="viewcode-back" href="../api.html#Animate.bake_all_animations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bake_all_animations</span><span class="p">(</span><span class="n">element_list</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">end_frame</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;.fbx&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bakes all the animations in the scene.</span>
<span class="sd">    </span>
<span class="sd">    :param element_list: (List[bpy.data.object]) The list of elements present in the scene</span>
<span class="sd">    :param bond_list: (List[bpy.data.object]) The list of bonds present in the scene</span>
<span class="sd">    :param end_frame: (int) Optional. Determines the length of the animation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s2">&quot;.fbx&quot;</span><span class="p">:</span>
        <span class="n">bake_for_fbx</span><span class="p">(</span><span class="n">element_list</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span><span class="o">==</span><span class="s2">&quot;.glb&quot;</span><span class="p">:</span>
        <span class="n">bake_for_glb</span><span class="p">(</span><span class="n">element_list</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">)</span>
        <span class="n">force_nla_tracks_for_glb</span><span class="p">(</span><span class="n">element_list</span> <span class="o">+</span> <span class="n">bond_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported mode &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;. Only &#39;.fbx&#39; and &#39;.glb&#39; are allowed.&quot;</span><span class="p">)</span></div>

                    
<div class="viewcode-block" id="animate">
<a class="viewcode-back" href="../api.html#Animate.animate">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">animate</span><span class="p">(</span><span class="n">anim_frames_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;.fbx&quot;</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orchestrates animation of molecular elements and bonds.</span>
<span class="sd">    </span>
<span class="sd">    :param anim_frames_path: Filepath of the animation data.</span>
<span class="sd">    :type anim_frames_path: str</span>
<span class="sd">    :param step_size: Frame interval between keyframes.</span>
<span class="sd">    :type step_size: int, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;8: animation function is called&quot;</span><span class="p">)</span>
    <span class="n">raw_anim_data</span> <span class="o">=</span> <span class="n">ExtractDataFromFile</span><span class="p">(</span><span class="n">anim_frames_path</span><span class="p">)</span>
    <span class="n">anim_data</span> <span class="o">=</span> <span class="n">refine_anim_data</span><span class="p">(</span><span class="n">raw_anim_data</span><span class="p">)</span>
    <span class="n">number_of_frames</span> <span class="o">=</span> <span class="n">calculate_number_of_frames</span><span class="p">(</span><span class="n">anim_frames_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;9: the number of frames is: &quot;</span><span class="p">,</span> <span class="n">number_of_frames</span><span class="p">)</span>
    <span class="n">element_list</span> <span class="o">=</span> <span class="n">separate_elements_from_bonds</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bond_list</span> <span class="o">=</span> <span class="n">separate_elements_from_bonds</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bond_types</span> <span class="o">=</span> <span class="n">detect_bond_types</span><span class="p">(</span><span class="n">bond_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;9: present bonds are: &quot;</span><span class="p">,</span> <span class="n">bond_types</span><span class="p">)</span>
    <span class="n">end_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">number_of_frames</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;9: the end frame is assigned to: &quot;</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">)</span>
    <span class="n">build_animations</span><span class="p">(</span><span class="n">anim_data</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">bond_types</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">number_of_frames</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">)</span>
    <span class="n">bake_all_animations</span><span class="p">(</span><span class="n">element_list</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">end_frame</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="export_animation">
<a class="viewcode-back" href="../api.html#Animate.export_animation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">export_animation</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exports the current Blender scene as an animation to the specified file path.</span>
<span class="sd">    Supports .fbx and .glb formats.</span>

<span class="sd">    :param filepath: (str) Full path (including extension) where the animation will be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exporting animation to:&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.fbx&quot;</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">export_scene</span><span class="o">.</span><span class="n">fbx</span><span class="p">(</span>
                <span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
                <span class="n">check_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">use_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">global_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">apply_unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">bake_anim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">bake_anim_use_all_bones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bake_anim_use_nla_strips</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bake_anim_use_all_actions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bake_anim_force_startend_keying</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">bake_anim_step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">bake_anim_simplify_factor</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">use_mesh_modifiers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">embed_textures</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.glb&quot;</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">export_scene</span><span class="o">.</span><span class="n">gltf</span><span class="p">(</span>
                <span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
                <span class="n">export_format</span><span class="o">=</span><span class="s1">&#39;GLB&#39;</span><span class="p">,</span>
                <span class="n">use_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">export_animations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">export_materials</span><span class="o">=</span><span class="s1">&#39;EXPORT&#39;</span><span class="p">,</span>
                <span class="n">export_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">export_force_sampling</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported animation export format: </span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Animation successfully exported to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permission error: Unable to export animation to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while exporting animation to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>




    
<span class="c1"># TO DEBUG</span>
<span class="c1">#raw_anim_data = ExtractDataFromFile(dir+&quot;\\animation_frames.txt&quot;)</span>
<span class="c1">#number_of_frames = calculate_number_of_frames(dir+&quot;\\animation_frames.txt&quot;)</span>
<span class="c1">#export_path = (&quot;C:\\Documents\\Gaussian-2-Blender\\output\\water.fbx&quot;)</span>
<span class="c1">#anim_data = refine_anim_data(raw_anim_data)</span>
<span class="c1">#element_list = separate_elements_from_bonds()[0]</span>
<span class="c1">#bond_list = separate_elements_from_bonds()[1]</span>
<span class="c1">#bond_types = detect_bond_types(bond_list)</span>
<span class="c1">#end_frame = (number_of_frames - 1)*20</span>

<span class="c1">#build_animations(anim_data, bond_list, bond_types, 20, number_of_frames, end_frame)</span>
<span class="c1">#bake_all_animations(element_list, bond_list, end_frame)</span>
<span class="c1">#export_animation(export_path)</span>

<span class="c1">#clear_all_animations()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Gaussian-2-Blender</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html#instructions">Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results.html">Visualizing Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html#file-structure">File structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gui.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Blender API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components.html">Program Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cite.html">Cite this program</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Emmanuel Echeverri-Jimenez.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>